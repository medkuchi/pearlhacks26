<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Find Your Perfect Roommate</title>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,400;0,500;0,600;1,400&family=Fraunces:wght@700&display=swap" rel="stylesheet"/>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #a3bfd2;
      --accept: #4B9CD3;
      --reject: #ff4d4d;
      --card-radius: 28px;
    }

    body {
      font-family: 'DM Sans', sans-serif;
      background: var(--bg);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    /* NAV */
    nav {
      position: fixed;
      top: 0; left: 0; right: 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 18px 32px;
      background: rgba(232, 234, 246, 0.85);
      backdrop-filter: blur(4px);
      z-index: 100;
    }

    .logo {
      font-family: 'Fraunces', serif;
      font-size: 1.7rem;
      color: var(--accept);
      letter-spacing: -1px;
    }

    .nav-links a {
      text-decoration: none;
      color: #666;
      font-size: 0.9rem;
      font-weight: 500;
      margin-left: 28px;
      transition: color 0.2s;
    }

    .nav-links a:hover { color: var(--accept); }

    /* CARD STACK */
    .card-stack {
      position: relative;
      width: 380px;
      height: 520px;
      margin-top: 20px;
    }

    .card-stack::after {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: var(--card-radius);
      background: #91abbc;
      transform: rotate(-4deg) translateY(8px);
      z-index: 0;
    }

    .card-stack::before {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: var(--card-radius);
      background: #82a7c0;
      transform: rotate(3deg) translateY(5px);
      z-index: 1;
    }

    /* MAIN CARD */
    .card {
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: var(--card-radius);
      overflow: hidden;
      z-index: 2;
      box-shadow: 0 20px 60px rgba(0,0,0,0.18);
      user-select: none;
      cursor: grab;
    }

    .card:active { cursor: grabbing; }

    .card img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      pointer-events: none;
      display: block;
    }

    /* GRADIENT OVERLAY */
    .card-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(
        to top,
        rgba(0,0,0,0.80) 0%,
        rgba(0,0,0,0.25) 45%,
        transparent 72%
      );
      display: flex;
      align-items: flex-end;
      padding: 24px;
    }

    /* INFO BUTTON */
    .info-btn {
      position: absolute;
      top: 16px;
      right: 16px;
      width: 38px;
      height: 38px;
      border-radius: 50%;
      background: rgba(255,255,255,0.2);
      backdrop-filter: blur(6px);
      border: 1.5px solid rgba(255,255,255,0.45);
      color: white;
      font-size: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 4;
      transition: background 0.2s;
    }

    .info-btn:hover { background: rgba(255,255,255,0.35); }

    /* CARD INFO */
    .card-info {
      color: white;
      flex: 1;
    }

    .card-info h2 {
      font-family: 'Fraunces', serif;
      font-size: 2rem;
      font-weight: 700;
      line-height: 1.1;
      margin-bottom: 8px;
    }

    .card-info .detail {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.87rem;
      color: rgba(255,255,255,0.88);
      margin-bottom: 5px;
    }

    /* COMPATIBILITY BADGE */
    .compatibility-badge {
      background: var(--accept);
      color: white;
      font-size: 0.78rem;
      font-weight: 600;
      padding: 6px 14px;
      border-radius: 20px;
      align-self: flex-end;
      white-space: nowrap;
    }

    /* SWIPE INDICATORS */
    .like-indicator,
    .nope-indicator {
      position: absolute;
      top: 40px;
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 1.4rem;
      font-weight: 700;
      opacity: 0;
      pointer-events: none;
      z-index: 10;
      letter-spacing: 1px;
    }

    .like-indicator {
      left: 24px;
      color: #4ade80;
      border: 3px solid #4ade80;
      transform: rotate(-15deg);
    }

    .nope-indicator {
      right: 24px;
      color: var(--reject);
      border: 3px solid var(--reject);
      transform: rotate(15deg);
    }

    /* ACTION BUTTONS */
    .action-buttons {
      display: flex;
      gap: 32px;
      margin-top: 32px;
      z-index: 10;
    }

    .btn-reject,
    .btn-accept {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.15s, box-shadow 0.15s;
    }

    .btn-reject {
      background: white;
      color: var(--reject);
      box-shadow: 0 4px 20px rgba(255,77,77,0.2);
    }

    .btn-accept {
      background: var(--accept);
      color: white;
      box-shadow: 0 4px 20px rgba(123,110,246,0.4);
    }

    .btn-reject:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 24px rgba(255,77,77,0.35);
    }

    .btn-accept:hover {
      transform: scale(1.1);
      /*box-shadow: 0 6px 24px rgba(13, 4, 96, 0.55);*/
    }

    /* EXPANDED INFO PANEL */
    .info-panel {
      position: absolute;
      inset: 0;
      background: rgba(10,10,20,0.92);
      border-radius: var(--card-radius);
      color: rgb(0, 0, 0);
      padding: 28px 24px;
      z-index: 5;
      display: none;
      flex-direction: column;
      gap: 16px;
      overflow-y: auto;
    }

    .info-panel.visible { display: flex; }

    .info-panel h3 {
      font-family: 'Fraunces', serif;
      font-size: 1.6rem;
    }

    .close-btn {
      position: absolute;
      top: 16px;
      right: 16px;
      background: rgba(255,255,255,0.12);
      border: none;
      color: white;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      font-size: 0.9rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .info-row {
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .info-row label {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 1.2px;
      color: rgba(255,255,255,0.45);
    }

    .info-row span {
      font-size: 0.93rem;
      color: rgba(255,255,255,0.9);
    }

    .bio-text {
      font-size: 0.9rem;
      color: rgba(255,255,255,0.75);
      line-height: 1.55;
      font-style: italic;
      border-left: 2px solid var(--accept);
      padding-left: 12px;
    }

    /* Message that appears when no more cards are available */
    .no-more {
      display: none;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      color: #888;
      text-align: center;
    }

    .no-more .emoji { font-size: 3.5rem; }
    .no-more h3 { font-family: 'Fraunces', serif; font-size: 1.4rem; color: #555; }
    .no-more p { font-size: 0.85rem; color: #ffffff; }
  </style>
</head>
<body>
    
  <div class="no-more" id="noMore">
    <div class="emoji">üò¢</div>
    <h3>End of pile... Come back later!</h3>
    <p>Check back later for more roommate matches!</p>
  </div>

  <div class="card-stack" id="cardStack">
    <div class="card" id="currentCard" data-id="{{user.id}}">

      <img src="{{user.image}}" alt="{{user.name}}"/>

      <div class="like-indicator" id="likeIndicator">ROOMIE!</div>
      <div class="nope-indicator" id="nopeIndicator">NOPE</div>

      <button class="info-btn" id="infoBtn">‚ìò</button>

      <div class="card-overlay">
        <div class="card-info">
          <h2>{{user.name}}, {{user.age}}</h2>
          <div class="detail">üéì {{user.year}} ¬∑ {{user.major}}</div>
          <div class="detail">üí§ {{user.sleep_schedule}}</div>
          <div class="detail">üí∞Ôπ©{{user.rent_min}}‚Äì${{user.rent_max}}/month</div>
          <div class="detail">üè† {{user.living_preference}} ¬∑ {{user.building_preference}}</div>
        </div>
        <div class="compatibility-badge">{{user.compatibility}}% Match</div>
      </div>

      <div class="info-panel" id="infoPanel">
        <button class="close-btn" id="closeBtn">‚úï</button>
        <h3>{{user.name}}</h3>
        <p class="bio-text">{{user.bio}}</p>
        <div class="info-row"><label>Cleanliness</label><span>{{user.cleanliness}}/5</span></div>
        <div class="info-row"><label>Bedrooms / Bathrooms</label><span>{{user.num_bedrooms}} bed ¬∑ {{user.num_bathrooms}} bath</span></div>
        <div class="info-row"><label>Building Preference</label><span>{{user.building_preference}}</span></div>
        <div class="info-row"><label>Why you match</label><span>{{user.reasoning}}</span></div>
      </div>

    </div>
  </div>

  <div class="action-buttons" id="actionButtons">
    <button class="btn-reject" id="rejectBtn">‚úï</button>
    <button class="btn-accept" id="acceptBtn">‚ô•</button>
  </div>

  <script>
    const card = document.getElementById('currentCard');
    const cardStack = document.getElementById('cardStack');
    const likeIndicator = document.getElementById('likeIndicator');
    const nopeIndicator = document.getElementById('nopeIndicator');
    const infoBtn = document.getElementById('infoBtn');
    const infoPanel = document.getElementById('infoPanel');
    const closeBtn = document.getElementById('closeBtn');
    const rejectBtn = document.getElementById('rejectBtn');
    const acceptBtn = document.getElementById('acceptBtn');
    const noMore = document.getElementById('noMore');
    const actionButtons = document.getElementById('actionButtons');

    let isDragging = false;
    let startX = 0;
    let currentX = 0;
    const THRESHOLD = 100;

    card.addEventListener('mousedown', (e) => {
      if (infoPanel.classList.contains('visible')) return;
      isDragging = true;
      startX = e.clientX;
      card.style.transition = 'none';
    });

    document.addEventListener('mousemove', (e) => {
      if (!isDragging) return;
      currentX = e.clientX - startX;
      const rotate = currentX * 0.08;
      card.style.transform = `translateX(${currentX}px) rotate(${rotate}deg)`;

      if (currentX > 30) {
        likeIndicator.style.opacity = Math.min(currentX / THRESHOLD, 1);
        nopeIndicator.style.opacity = 0;
      } else if (currentX < -30) {
        nopeIndicator.style.opacity = Math.min(-currentX / THRESHOLD, 1);
        likeIndicator.style.opacity = 0;
      } else {
        likeIndicator.style.opacity = 0;
        nopeIndicator.style.opacity = 0;
      }
    });

    document.addEventListener('mouseup', () => {
      if (!isDragging) return;
      isDragging = false;

      if (currentX > THRESHOLD) {
        flyOff('right');
      } else if (currentX < -THRESHOLD) {
        flyOff('left');
      } else {
        card.style.transition = 'transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
        card.style.transform = 'translateX(0) rotate(0deg)';
        likeIndicator.style.opacity = 0;
        nopeIndicator.style.opacity = 0;
      }
      currentX = 0;
    });

    rejectBtn.addEventListener('click', () => flyOff('left'));
    acceptBtn.addEventListener('click', () => flyOff('right'));

    function flyOff(direction) {
      const x = direction === 'right' ? 1200 : -1200;
      const rotate = direction === 'right' ? 30 : -30;
      card.style.transition = 'transform 0.5s ease, opacity 0.5s ease';
      card.style.transform = `translateX(${x}px) rotate(${rotate}deg)`;
      card.style.opacity = '0';
      likeIndicator.style.opacity = 0;
      nopeIndicator.style.opacity = 0;

      // TODO: swap this for real Flask POST when wiring up
      // const userId = card.dataset.id;
      // fetch('/swipe', {
      //   method: 'POST',
      //   headers: { 'Content-Type': 'application/json' },
      //   body: JSON.stringify({ swiped_id: userId, direction: direction })
      // });

      setTimeout(() => {
        cardStack.style.display = 'none';
        actionButtons.style.display = 'none';
        noMore.style.display = 'flex';
      }, 500);
    }

    infoBtn.addEventListener('click', () => infoPanel.classList.add('visible'));
    closeBtn.addEventListener('click', () => infoPanel.classList.remove('visible'));
  </script>

</body>
</html>